# Copyright 2017 Cheng Zhao. All rights reserved.
# Use of this source code is governed by the license that can be found in the
# LICENSE file.

config("lua_config") {
  include_dirs = [ "." ]
}

executable("lua") {
  sources = [ "lua.c" ]
  deps = [ ":liblua" ]
}

executable("luac") {
  sources = [ "luac.c" ]
  deps = [ ":liblua" ]
}

source_set("liblua") {
  sources = [
    "lapi.c",
    "lapi.h",
    "lauxlib.c",
    "lauxlib.h",
    "lbaselib.c",
    "lbitlib.c",
    "lcode.c",
    "lcode.h",
    "lcorolib.c",
    "lctype.c",
    "lctype.h",
    "ldblib.c",
    "ldebug.c",
    "ldebug.h",
    "ldo.c",
    "ldo.h",
    "ldump.c",
    "lfunc.c",
    "lfunc.h",
    "lgc.c",
    "lgc.h",
    "linit.c",
    "liolib.c",
    "llex.c",
    "llex.h",
    "llimits.h",
    "lmathlib.c",
    "lmem.c",
    "lmem.h",
    "loadlib.c",
    "lobject.c",
    "lobject.h",
    "lopcodes.c",
    "lopcodes.h",
    "loslib.c",
    "lparser.c",
    "lparser.h",
    "lprefix.h",
    "lstate.c",
    "lstate.h",
    "lstring.c",
    "lstring.h",
    "lstrlib.c",
    "ltable.c",
    "ltable.h",
    "ltablib.c",
    "ltm.c",
    "ltm.h",
    "lua.h",
    "luaconf.h",
    "lualib.h",
    "lundump.c",
    "lundump.h",
    "lutf8lib.c",
    "lvm.c",
    "lvm.h",
    "lzio.c",
    "lzio.h",
  ]

  if (is_win) {
    cflags = [
      "/wd4310",  # cast truncates constant value
      "/wd4324",  # structure was padded due to alignment specifier
    ]
  }
  if (is_posix) {
    defines = [ "LUA_USE_POSIX" ]
    configs -= [ "//build/config/gcc:symbol_visibility_hidden" ]
    configs += [ "//build/config/gcc:symbol_visibility_default" ]
  }

  public_configs = [ ":lua_config" ]
}
